# üñºÔ∏è –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ Directus

## –†–∞—Å—Å—ã–ª–∫–∏ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏

1. –ó–∞–π–¥–∏ –≤ **Directus ‚Üí Content ‚Üí Broadcasts**
2. –°–æ–∑–¥–∞–π –Ω–æ–≤—É—é —Ä–∞—Å—Å—ã–ª–∫—É:
   - **Title:** –ù–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏ (–Ω–µ –≤–∏–¥–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º)
   - **Message Text:** –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç HTML)
   - **Message Photo URL:** –°—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
   - **Target Audience:** –ö–æ–º—É –æ—Ç–ø—Ä–∞–≤–∏—Ç—å (`all`, `premium`, `free`)
   - **Status:** –£—Å—Ç–∞–Ω–æ–≤–∏ `draft`

3. –î–æ–±–∞–≤—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–¥–Ω–∏–º –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤:

### –í–∞—Ä–∏–∞–Ω—Ç 1: Upload –≤ Directus (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```
1. Settings ‚Üí Files ‚Üí Upload file
2. –°–∫–æ–ø–∏—Ä—É–π URL —Ñ–∞–π–ª–∞ (–±—É–¥–µ—Ç –≤–∏–¥–∞: https://directus.example.com/assets/abc123...)
3. –í—Å—Ç–∞–≤—å –≤ –ø–æ–ª–µ message_photo_url
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞
```
message_photo_url: https://example.com/image.jpg
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: Telegram File ID (–¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
```
message_photo_url: AgACAgIAAxkBAAI...
```

4. –ò–∑–º–µ–Ω–∏ **Status** –Ω–∞ `sending` ‚Üí –†–∞—Å—Å—ã–ª–∫–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Directus Flow

---

## –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏

### –î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—é (/start)

1. –ó–∞–π–¥–∏ –≤ **Directus ‚Üí Content ‚Üí App Settings**
2. –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π –∫–ª—é—á:
   ```
   Key: msg.welcome_photo
   Value: "https://your-directus.com/assets/welcome.jpg"
   Description: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
   ```

3. –û–±–Ω–æ–≤–∏ –∫–æ–¥ –±–æ—Ç–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —ç—Ç–æ–≥–æ –∫–ª—é—á–∞ (–ø—Ä–∏–º–µ—Ä –Ω–∏–∂–µ)

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –±–æ—Ç–µ

```typescript
// server/src/bot/index.ts
bot.command('start', async (ctx) => {
  const welcomeMessage = await getMessage('msg.welcome');
  const welcomePhoto = await configService.get('msg.welcome_photo');
  
  if (welcomePhoto) {
    await ctx.replyWithPhoto(welcomePhoto, {
      caption: welcomeMessage,
      parse_mode: 'Markdown',
      reply_markup: { inline_keyboard: keyboard }
    });
  } else {
    await ctx.reply(welcomeMessage, {
      parse_mode: 'Markdown',
      reply_markup: { inline_keyboard: keyboard }
    });
  }
});
```

---

## –§–æ—Ä–º–∞—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

| –§–æ—Ä–º–∞—Ç | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è | –ü—Ä–∏–º–µ—Ä |
|--------|----------------|--------|
| JPEG | ‚úÖ | `https://example.com/image.jpg` |
| PNG | ‚úÖ | `https://example.com/image.png` |
| GIF | ‚úÖ | `https://example.com/animation.gif` |
| WebP | ‚úÖ | `https://example.com/image.webp` |
| HEIC | ‚ùå | –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è Telegram |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä: 10 MB
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —à–∏—Ä–∏–Ω–∞: 800-1280px
- –§–æ—Ä–º–∞—Ç: JPEG –¥–ª—è —Ñ–æ—Ç–æ, PNG –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∏ —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é

---

## Troubleshooting

### –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ URL –¥–æ—Å—Ç—É–ø–µ–Ω –ø—É–±–ª–∏—á–Ω–æ (–æ—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ)
2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ñ–æ—Ä–º–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
3. –ü—Ä–æ–≤–µ—Ä—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (< 10 MB)
4. –ü–æ—Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ –±–æ—Ç–∞: `pm2 logs 0`

### –†–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –±–µ–∑ –∫–∞—Ä—Ç–∏–Ω–∫–∏
1. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø–æ–ª–µ `message_photo_url` –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –≤ Directus
2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ Directus Flow –ø–µ—Ä–µ–¥–∞–µ—Ç —ç—Ç–æ –ø–æ–ª–µ –≤ webhook
3. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ API: `/var/www/mindful-journal/server/logs/`

### –û—à–∏–±–∫–∞ "Invalid file URL"
- URL –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `https://` –∏–ª–∏ –±—ã—Ç—å Telegram File ID
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Ñ–∞–π–ª –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞
